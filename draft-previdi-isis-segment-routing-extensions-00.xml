<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="std" docName="draft-previdi-isis-segment-routing-extensions-00"
     ipr="trust200902">
  <front>
    <title abbrev="IS-IS Extensions for Segment Routing">IS-IS Extensions for
    Segment Routing</title>

    <author fullname="Stefano Previdi" initials="S." role="editor"
            surname="Previdi">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>Via Del Serafico, 200</street>

          <city>Rome</city>

          <code>00142</code>

          <country>Italy</country>
        </postal>

        <email>sprevidi@cisco.com</email>
      </address>
    </author>

    <author fullname="Clarence Filsfils" initials="C." surname="Filsfils">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street></street>

          <city>Brussels</city>

          <region></region>

          <code></code>

          <country>BE</country>
        </postal>

        <email>cfilsfil@cisco.com</email>
      </address>
    </author>

    <author fullname="Ahmed Bashandy" initials="A." surname="Bashandy">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>170, West Tasman Drive</street>

          <city>San Jose</city>

          <region>CA</region>

          <code>95134</code>

          <country>US</country>
        </postal>

        <email>bashandy@cisco.com</email>
      </address>
    </author>

    <author fullname="Bruno Decraene" initials="B." surname="Decraene">
      <organization>Orange</organization>

      <address>
        <postal>
          <street></street>

          <city></city>

          <code></code>

          <country>FR</country>
        </postal>

        <email>bruno.decraene@orange.com</email>
      </address>
    </author>

    <author fullname="Stephane Litkowski" initials="S." surname="Litkowski">
      <organization>Orange</organization>

      <address>
        <postal>
          <street></street>

          <city></city>

          <code></code>

          <country>FR</country>
        </postal>

        <email>stephane.litkowski@orange.com</email>
      </address>
    </author>

    <author fullname="Rudiger Geib" initials="R." surname="Geib">
      <organization>Deutsche Telekom</organization>

      <address>
        <postal>
          <street></street>

          <city></city>

          <code></code>

          <country>DE</country>
        </postal>

        <email>Rudiger.Geib@telekom.de</email>
      </address>
    </author>

    <author fullname="Igor Milojevic" initials="I." surname="Milojevic">
      <organization>Telekom Srbija</organization>

      <address>
        <postal>
          <street>Takovska 2</street>

          <city>Belgrade</city>

          <code></code>

          <country>RS</country>
        </postal>

        <email>igormilojevic@telekom.rs</email>
      </address>
    </author>

    <author fullname="Rob Shakir" initials="R." surname="Shakir">
      <organization>British Telecom</organization>

      <address>
        <postal>
          <street></street>

          <city>London</city>

          <code></code>

          <country>UK</country>
        </postal>

        <email>rob.shakir@bt.com</email>
      </address>
    </author>

    <author fullname="Saku Ytti" initials="S." surname="Ytti">
      <organization>TDC Oy</organization>

      <address>
        <postal>
          <street>Mechelininkatu 1a</street>

          <city>TDC</city>

          <code>00094</code>

          <country>FI</country>
        </postal>

        <email>saku@ytti.fi</email>
      </address>
    </author>

    <author fullname="Wim Henderickx" initials="W." surname="Henderickx">
      <organization>Alcatel-Lucent</organization>

      <address>
        <postal>
          <street>Copernicuslaan 50</street>

          <city>Antwerp</city>

          <code>2018</code>

          <country>BE</country>
        </postal>

        <email>wim.henderickx@alcatel-lucent.com</email>
      </address>
    </author>

    <author fullname="Jeff Tantsura" initials="J." surname="Tantsura">
      <organization>Ericsson</organization>

      <address>
        <postal>
          <street>300 Holger Way</street>

          <city>San Jose</city>

          <region>CA</region>

          <code>95134</code>

          <country>US</country>
        </postal>

        <email>Jeff.Tantsura@ericsson.com</email>
      </address>
    </author>

    <date day="11" month="June" year="2013" />

    <workgroup>IS-IS for IP Internets</workgroup>

    <abstract>
      <t>Segment Routing (SR) allows for a flexible definition of end-to-end
      paths within IGP topologies by encoding paths as sequences of
      topological sub-paths, called "segments". These segments are advertised
      by the link-state routing protocols (IS-IS and OSPF).</t>

      <t>This draft describes the necessary IS-IS extensions that need to be
      introduced for Segment Routing.</t>
    </abstract>

    <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119">RFC 2119</xref>.</t>
    </note>
  </front>

  <middle>
    <section title="Introduction">
      <t>Segment Routing (SR) allows for a flexible definition of end-to-end
      paths within IGP topologies by encoding paths as sequences of
      topological sub-paths, called "segments". These segments are advertised
      by the link-state routing protocols (IS-IS and OSPF). Two types of
      segments are defined, Prefix segments and Adjacency segments. Prefix
      segments represent an ecmp-aware shortest-path to a prefix, as per the
      state of the IGP topology. Adjacency segments represent a hop over a
      specific adjacency between two nodes in the IGP. A prefix segment is
      typically a multi-hop path while an adjacency segment, in most of the
      cases, is a one-hop path. SR's control-plane can be applied to both IPv6
      and MPLS data-planes, and do not require any additional signaling (other
      than the regular IGP). For example, when used in MPLS networks, SR paths
      do not require any LDP or RSVP-TE signaling. Still, SR can interoperate
      in the presence of LSPs established with RSVP or LDP .</t>

      <t>This draft describes the necessary IS-IS extensions that need to be
      introduced for Segment Routing.</t>

      <t>Segment Routing architecture is described in <xref
      target="draft-filsfils-rtgwg-segment-routing-00"></xref>.</t>

      <t>Segment Routing use cases are described in <xref
      target="draft-filsfils-rtgwg-segment-routing-use-cases-00"></xref>.</t>
    </section>

    <section title="Segment Routing Identifiers">
      <t>Segment Routing architecture defines different types of Segment
      Identifiers (SID). This document defines the IS-IS encodings for the
      IGP-Prefix-SID and IGP-Adjacency-SID.</t>

      <section anchor="PREFIXSIDSUBTLV"
               title="Prefix Segment Identifier (Prefix-SID Sub-TLV)">
        <t>A new IS-IS Sub-TLV is defined: the Prefix Segment Identifier
        Sub-TLV (Prefix-SID Sub-TLV).</t>

        <t>The Prefix-SID Sub-TLV carries the Segment Routing IGP-Prefix-SID
        and has flags and fields that may be used, in future extensions of
        Segment Routing, for carrying other types of SIDs.</t>

        <t>A Prefix-SID Sub-TLV is associated to a prefix advertised by a node
        and MAY be present in any of the following TLVs: <list style="hanging">
            <t>TLV-135 (IPv4) defined in <xref target="RFC5305"></xref>.</t>

            <t>TLV-235 (MT-ipv4) defined in <xref
            target="RFC5120"></xref>.</t>

            <t>TLV-236 (IPv6) defined in <xref target="RFC5308"></xref>.</t>

            <t>TLV-237 (MT-IPv6) defined in <xref
            target="RFC5120"></xref>.</t>
          </list></t>

        <t>The Prefix-SID Sub-TLV MUST follow the TLV (e.g.: TLV-135) it is
        attached to when propagated across level boundaries.</t>

        <t>The Prefix-SID Sub-TLV has the following format:<figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type        |     Length    |            Flags              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              Prefix Segment Identifier (SID)                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where:</artwork>
          </figure><list style="hanging">
            <t>Type: TBA</t>

            <t>Length: multiple of 6 octets.</t>

            <t>Flags: 2 octets field of following flags:<figure>
                <artwork>
       0                   1
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |R|N|P|G|                       | 
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      where: </artwork>
              </figure><list style="hanging">
                <t>R-Flag: Re-advertisement flag. If set, then the prefix to
                which this Prefix-SID is attached, has been propagated by the
                router either from another level (i.e.: from level-1 to
                level-2 or the opposite) or from redistribution (e.g.: from
                another protocol).</t>

                <t>N-Flag: Node-SID flag. Optional and, if set, then the
                Prefix-SID refers to the router identified by the prefix.
                Typically, the N-Flag is set on Prefix-SIDs attached to a
                router loopback address. The N-Flag is set when the Prefix-SID
                is a Node-SID as described in <xref
                target="draft-filsfils-rtgwg-segment-routing-00"></xref>.</t>

                <t>P-Flag: no-PHP flag. If set, then the penultimate hop MUST
                NOT pop the Prefix-SID before delivering the packet to the
                node that advertised the Prefix-SID.</t>

                <t>G-Flag: Global flag. When set, the SID value has global
                significance which means the SID has been allocated from the
                Global Segment Routing Block (SRGB) as described in <xref
                target="draft-filsfils-rtgwg-segment-routing-00"></xref>. When
                unset, the SID value has local (within the router)
                significance which means the SID has NOT been allocated from
                the SRGB. When the IS-IS Prefix-SID Sub-TLV carries an IGP
                Prefix SID, then the G-flag MUST be set.</t>

                <t>Other bits: MUST be zero when originated and ignored when
                received.</t>
              </list></t>

            <t>Prefix Segment Identifier (SID): 32 bits of Prefix-SID.</t>
          </list></t>

        <t>Multiple Prefix-SIDs MAY appear on the same prefix in which case
        each SID is encoded as a tuple &lt;flags, Prefix-SID&gt;. When
        multiple Prefix-SIDs are present, the receiving router MUST use the
        first encoded SID and MAY use the subsequent ones.</t>

        <t>The No-PHP flag MUST be set on the Prefix-SIDs associated with
        Reachability advertisements which were originated by other routers and
        leaked (either from Level-1 to Level-2 or vice versa).</t>

        <t>The R-Flag MUST be set for prefixes that are not local to the
        router and either:<list style="hanging">
            <t>advertised because of propagation (Level-1 into Level-2);</t>

            <t>advertised because of leaking (Level-2 into Level-1);</t>

            <t>advertised because redistribution (e.g.: from another
            protocol).</t>
          </list></t>

        <t>In the case where a Level-1-2 router has local interface addresses
        configured in one level, it may also propagate these addresses into
        the other level. In such case, the Level-1-2 router MUST NOT set the R
        bit. The R-bit MUST be set only for prefixes that are not local to the
        router and advertised by the router because of propagation and/or
        leaking.</t>

        <t>The N-Flag is used in order to define a Node-SID. A router MAY set
        the N-Flag only if all of the following conditions are met:<list
            style="hanging">
            <t>The prefix to which the Prefix-SID is attached is local to the
            router. I.e.: the prefix is configured on one of the local
            interfaces. (e.g.: loopback).</t>

            <t>The prefix to which the Prefix-SID is attached has a mask
            length of 32.</t>
          </list></t>

        <t>The router MUST ignore the N-Flag on a received Prefix-SID if the
        prefix has a mask length different than 32.</t>

        <t>The router behavior determined by the P, R and N flags are
        described in <xref
        target="draft-filsfils-rtgwg-segment-routing-00"></xref>.</t>
      </section>

      <section title="Adjacency Segment Identifier (Adj-SID)">
        <t>A new IS-IS Sub-TLV is defined: the Adjacency Segment Identifier
        Sub-TLV (Adj-SID Sub-TLV).</t>

        <t>The Adj-SID Sub-TLV is an optional Sub-TLV carrying the Segment
        Routing IGP-Adjacency-SID with flags and fields that may be used, in
        future extensions of Segment Routing, for carrying other types of
        SIDs.</t>

        <t>IS-IS adjacencies are advertised using one of the IS-Neighbor TLVs
        below:<list style="hanging">
            <t>TLV-22 <xref target="RFC5305"></xref></t>

            <t>TLV-222 <xref target="RFC5120"></xref></t>

            <t>TLV-23 <xref target="RFC5311"></xref></t>

            <t>TLV-223 <xref target="RFC5311"></xref></t>

            <t>TLV-141 <xref target="RFC5316"></xref></t>
          </list></t>

        <t>Currently, <xref target="RFC5316"></xref> defines TLV-141 with the
        purpose of inter-AS connectivity. In the Segment Routing context, we
        relax the constraint and we allow TLV-141 to be used for advertising
        any link that is external to the IS-IS domain no matter if it connects
        another AS or not.</t>

        <t>Multiple Adj-SID Sub-TLVs MAY be associated with a single
        IS-neighbor. Examples where more than one Adj-SID may be used per
        IS-neighbor are described in <xref
        target="draft-filsfils-rtgwg-segment-routing-use-cases-00"></xref>.</t>

        <section title="Adj-SID and Forwarding Adjacencies">
          <t>Forwarding Adjacencies are defined in <xref
          target="RFC4206"></xref> and allow a router to advertise an MPLS
          RSVP-TE LSP as if it was a regular IS-IS adjacency.</t>

          <t>Segment Routing supports FAs and Adj-SIDs can be assigned to FA
          advertisements. A new sub-TLV (defined below) is introduced in order
          to give the optional ability to advertise the explicit path
          represented by a FA.</t>
        </section>

        <section anchor="ADJSIDSUBTLV"
                 title="Adjacency Segment Identifier (Adj-SID) Sub-TLV">
          <t>The following format is defined for the Adj-SID Sub-TLV:<figure>
              <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type        |     Length    |             Flags             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             Adj-SID                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     ERO (optional and variable)               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where:</artwork>
            </figure><list style="hanging">
              <t>Type: TBA</t>

              <t>Length: variable.</t>

              <t>Flags: 2 octets field of following flags:<figure>
                  <artwork> 
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |F|I|V|E|G|T|                   | 
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      where:</artwork>
                </figure><list style="hanging">
                  <t>F-Flag: FA flag. If set, then Adj-SID refers to a
                  Forwarding Adjacency.</t>

                  <t>I-Flag: IPv4 flag. If set, then the Adj-SID refers to an
                  adjacency with outgoing IPv4 encapsulation.</t>

                  <t>V-Flag: IPv6 flag. If set, then the Adj-SID refers to an
                  adjacency with outgoing IPv6 encapsulation.</t>

                  <t>E-Flag: ERO presence flag. If set, it indicates presence
                  of the ERO object.</t>

                  <t>G-Flag: Global flag. When set, the SID value has global
                  significance which means the SID has been allocated from the
                  Segment Routing Global Block (SRGB) as described in <xref
                  target="draft-filsfils-rtgwg-segment-routing-00"></xref>.
                  When unset, the SID value has local (within the router)
                  significance which means the SID has NOT been allocated from
                  the SRGB. When the IS-IS Adj-SID Sub-TLV carries the IGP
                  Adjacency SID, then the G-Flag MUST be unset.</t>

                  <t>T-Flag: Protected-flag. If set, the Adj-SID refers to an
                  adjacency being protected (e.g.: using IPFRR or MPLS-FRR) as
                  described in <xref
                  target="draft-filsfils-rtgwg-segment-routing-use-cases-00"></xref>.</t>

                  <t>Other bits: MUST be zero when originated and ignored when
                  received.</t>
                </list></t>

              <t>Adj-SID: 32 bits of Adjacency Segment Identifier
              (Adj-SID).</t>

              <t>An SR capable router SHOULD allocate an Adj-SID for each of
              its adjacencies and set the T-Flag when the adjacency is
              protected by a FRR mechanism (IP or MPLS) as described in <xref
              target="draft-filsfils-rtgwg-segment-routing-use-cases-00"></xref>.</t>

              <t>The "I" and "V" flags are used in order for the router to
              advertise the outgoing encapsulation of the adjacency the
              Adj-SID is attached to. Use cases of the use of "I" and "V"
              flags are described in <xref
              target="draft-filsfils-rtgwg-segment-routing-use-cases-00"></xref>.</t>

              <t>At least one among the "I" and "V" flags MUST be set. Both
              are set when the adjacency is both IPv4 and IPv6 capable (i.e.:
              the router has to inspect the first 4 bits of the IP packet
              (IPv4 or IPv6) in order to determine the outgoing
              encapsulation).</t>
            </list>If the E-flag is set, then the explicit path taken by the
          Forwarding Adjacency MUST be encoded using the following format:
          <figure>
              <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|     Length    |     Flags     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Explicit Route Hop  #1                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Explicit Route Hop  #...                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             ....                              |
   
where:</artwork>
            </figure><list>
              <t>Length: 1 octet of length of the ERO object.</t>

              <t>Flags: 1 octet flag field where following flags are
              defined:<figure>
                  <artwork>
       0 1 2 3 4 5 6 7 
      +-+-+-+-+-+-+-+-+
      |I|V|R|         | 
      +-+-+-+-+-+-+-+-+

      where:</artwork>
                </figure><list style="hanging">
                  <t>I-Flag is the IPv4 flag. When set the content of the
                  Explicit Route Object contains IPv4 addresses.</t>

                  <t>V-Flag is the IPv6 flag. When set the content of the
                  Explicit Route Object contains IPv6 addresses.</t>

                  <t>R-Flag is the Segment Routing flag. When set the content
                  of the Explicit Route Object contains SIDs.</t>
                </list></t>

              <t>Explicit Route Hop: addresses of the explicit route. IPv4 and
              SR hops are encoded using a 32 bit value while IPv6 hops are
              encoded as 128 bit values.</t>

              <t>Among the the "I", "V" and "R" flags, one MUST be set. If
              none or more than one are set , the receiving router MUST ignore
              the ERO object and SHOULD log an error.</t>
            </list></t>
        </section>

        <section title="Adjacency Segment Identifiers in LANs">
          <t>In LAN subnetworks, the Designated Intermediate System (DIS) is
          elected and originates the Pseudonode-LSP (PN-LSP) including all
          neighbors of the DIS.</t>

          <t>When Segment Routing is used, each router in the LAN MUST
          advertise the Adj-SID of each of its neighbors. Since, on LANs, each
          router only advertises one adjacency to the DIS (and doesn't
          advertise any other adjacency), each router advertises the set of
          Adj-SIDs (for each of its neighbors) inside a newly defined Sub-TLV
          part of the TLV advertising the adjacency to the DIS (e.g.:
          TLV-22).</t>

          <t>Inside the Adj-SID Sub-TLV described in <xref
          target="ADJSIDSUBTLV"></xref> the following new Sub-TLV is defined:
          LAN-Adj-SID which contains the set of Adj-SIDs the router assigned
          to each of its LAN neighbors. The format of the LAN-Adj-SID Sub-TLV
          is as follows:<figure>
              <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|   Type        |     Length    |      Flags    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Adj-SID    #1 (4 octets)                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     System-ID  #1 (6 octets)                  |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               |    
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               
|                             ....

|                             ....                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Adj-SID    #n (4 octets)                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     System-ID  #n                             |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where: </artwork>
            </figure><list style="hanging">
              <t>Type: TBA.</t>

              <t>Length: is 1 + multiple of 10 octets.</t>

              <t>Flags: 1 octet field of flags. None are defined at this
              stage. MUST be zero when originated and ignored when
              received.</t>

              <t>Adj-SID: 32 bits of SID.</t>

              <t>System-ID: IS-IS System-ID of length "ID Length" as defined
              in <xref target="ISO10589"></xref>.</t>
            </list></t>

          <t>Multiple tuples &lt;Adj-SID, System-ID&gt; SHOULD be encoded in
          one Sub-TLV.</t>

          <t>In case one TLV-22/23/222/223 (reporting the adjacency to the
          DIS) can't contain the whole set of Adj-SID Sub-TLVs, multiple
          advertisements of the adjacency to the DIS MUST be used, MUST have
          the same metric and SHOULD be inserted within the same LSP
          fragment.</t>

          <t>Each router within the level, by receiving the DIS PN LSP as well
          as the non-PN LSP of each router in the LAN, is capable of
          reconstructing the LAN topology as well as the set of Adj-SID each
          router uses for each of its neighbors.</t>
        </section>
      </section>
    </section>

    <section title="Segment Routing Capabilities">
      <t>Segment Routing requires each router to advertise its capabilities to
      the rest of the routing domain. IS-IS Router Capability TLV-242 is
      defined in <xref target="RFC4971"></xref> and describes the router
      capabilities. For the purposes of Segment Routing we define following
      additional Sub-TLVs: <list style="hanging">
          <t>Segment Routing Capability Sub-TLV (SR-Cap)</t>

          <t>Segment Routing Mapping Server Sub-TLV (SRMS)</t>

          <t>Segment Routing Mirroring Context SID Sub-TLV (SRMC)</t>
        </list></t>

      <t>The Router Capability TLV specifies flags that control its
      advertisement. The SR-Cap, SRMS and SRMC Sub-TLVs MUST be propagated
      throughout the entire routing domain and therefore the Router Capability
      TLV distribution flags MUST be set accordingly, i.e.: the S flag must be
      set and the D flag MUST be set when the Capability TLV is leaked into
      level-1.</t>

      <section anchor="SRCAP"
               title="Segment Routing Capability Sub-TLV (SR-Cap)">
        <t>The SR-Cap Sub-TLV is advertised by the SR-capable router in order
        to advertise its support of SR signaling.</t>

        <t>The SR-Cap Sub-TLV MUST appear only once and has following
        format:<figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type        |     Length    |           Flags               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        First SID Value                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Last SID Value                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where: </artwork>
          </figure><list style="hanging">
            <t>Type: TBA.</t>

            <t>Length: 2 octets + 8 octets if SID Values are advertised.</t>

            <t>Flags: 2 octets field of following flags:<figure>
                <artwork>
        0                   1
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |X|M|I|V|                       | 
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       where:</artwork>
              </figure><list style="hanging">
                <t>X-Flag: Index flag. If set, then each SID with the G-Flag
                set that is advertised by this router represents an index in
                the SID space also advertised by this router (using the
                encodings defined below). Indexed SID values are described in
                <xref
                target="draft-filsfils-rtgwg-segment-routing-00"></xref>. If
                the X-Flag is not set, then SID values 0-63 are reserved and
                MUST NOT be used by the SR control plane for either node or
                adjacency segments. Any SID which is received with a value
                0-63 and the X-Flag unset MUST be ignored and the router
                SHOULD log an error.</t>

                <t>M-Flag: SID space flag. If set, the router advertises SID
                space.</t>

                <t>I-Flag: IPv4 flag. If set, then the router is capable of
                outgoing IPv4 encapsulation on all interfaces.</t>

                <t>V-Flag: IPv6 flag. If set, then the router is capable of
                outgoing IPv6 encapsulation on all interfaces.</t>

                <t>Other bits: MUST be zero when originated and ignored when
                received.</t>
              </list></t>

            <t>First SID Value and Last SID Value represent the local SID
            range of the router. The semantic and procedures of these values
            are described in <xref
            target="draft-filsfils-rtgwg-segment-routing-use-cases-00"></xref>.</t>
          </list></t>

        <t>I-Flag and V-Flag define the outgoing encapsulations the router is
        capable of on all its interfaces.</t>
      </section>

      <section title="Segment Routing Mapping Server">
        <t>One or more SR capable routers may act as a Segment Routing Mapping
        Server (SRMS).</t>

        <t>One example (but not limited to) of SR Mapping Server use is when
        some of the routers in the network do not support Segment Routing and
        therefore they won't advertise any Prefix-SID. In such case the SRMS
        advertises the mappings on behalf of the non-SR capable routers.</t>

        <t>The details on the Segment Routing Mapping Server capability are
        described in <xref
        target="draft-filsfils-rtgwg-segment-routing-use-cases-00"></xref>.</t>

        <section title="SR Mapping Server Sub-TLV ">
          <t>The SR Mapping Server Sub-TLV (SRMS Sub-TLV) is used in order to
          advertise Prefix-SID mappings on behalf of routers. The SRMS Sub-TLV
          is optional and MAY appear more than once in the Router Capability
          TLV.</t>

          <t>The SRMS Sub-TLV has the following format: <figure>
              <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type        |     Length    |             Flags             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              ...                              |

where:</artwork>
            </figure><list>
              <t>Type: TBD.</t>

              <t>Length: variable.</t>

              <t>Flags. Following flags are defined:<figure>
                  <artwork>
 0                   1
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|I|V|R|                         | 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where:</artwork>
                </figure><list style="hanging">
                  <t>I-flag: IPv4 flag. If set then the carried mappings refer
                  to an IPv4 prefix.</t>

                  <t>V-flag: IPv6 flag. If set then the carried mappings refer
                  to an IPv6 prefix.</t>

                  <t>R-Flag: Range flag. When set, the mappings are expressed
                  using range values.</t>
                </list></t>
            </list></t>

          <t>The combination of the I, V flags with the R flag tells the
          Address Family and type of encodings. When the R-flag is not set,
          the following encoding format is used:<figure>
              <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type        |     Length    |             Flags             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Masklength and Prefix #1 (variable length)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Prefix-SID  #1   (4 octet length)         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              ...                              |

|                              ...                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Masklength and Prefix #n (variable length)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Prefix-SID  #n   (4 octet length)         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where:</artwork>
            </figure><list style="hanging">
              <t>Masklength and Prefix: the prefix to be mapped into a
              Prefix-SID consisting of 1 octet of prefix length followed by 0
              to 16 octets of IPv4 or IPv6 prefix (determined by the I and V
              flags).</t>

              <t>Prefix-SID: 4 octet Prefix Segment Identifier mapped to the
              prefix.</t>
            </list></t>

          <t>The 8 bits of prefix length can have the values 0-128 and
          indicate the number of significant bits in the prefix. The prefix is
          encoded in the minimal number of octets for the given number of
          significant bits as follows: <list style="hanging">
              <t>Prefix octets = integer of ((prefix length + 7) / 8)</t>
            </list></t>

          <t>The range option (the R bit) provides the ability to specify a
          range of addresses and the associated Prefix-SIDs. In fact, then the
          R bit allows to specify the first address, the number of addresses
          that need to be mapped into a Prefix-SID and the starting value of
          the Prefix-SID range.</t>

          <t>Therefore, with the R bit set, the following encoding is
          used:<figure align="center">
              <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type        |     Length    |             Flags             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        First Masklength and Prefix #1 (variable length)       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        First Prefix-SID #1 (4 octets)                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Range Size #1          |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              ...                              |
                               ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        First Masklength and Prefix #n (variable length)       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        First Prefix-SID #n (4 octets)                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Range Size #n          |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</artwork>
            </figure></t>

          <t>"First Masklength and Prefix #i" is treated as unsigned integer
          of size "Masklength" and consisting of the most significant
          "Masklength" bits. Let the value P be equal to "Prefix". The mapping
          can be characterized as follows:<figure>
              <artwork>
P/Masklength     maps to "First Prefix-SID #i"
(P+1)/Masklength maps to "First Prefix-SID #i" + 1
(P+2)/Masklength maps to "First Prefix-SID #i" + 2
...
(P + "Range Size #i" - 1)/Masklength maps to 
      ("First Prefix-SID #i" + "Range Size #i" -1)</artwork>
            </figure></t>

          <t>Example 1: if the following router addresses (loopback addresses)
          need to be mapped into the corresponding Prefix-SIDs: <figure
              suppress-title="true">
              <artwork>
Router-A: 192.0.2.1/32, Prefix-SID: 1001
Router-B: 192.0.2.2/32, Prefix-SID: 1002
Router-C: 192.0.2.3/32, Prefix-SID: 1003
Router-D: 192.0.2.4/32, Prefix-SID: 1004</artwork>
            </figure><figure suppress-title="true">
              <artwork>
The R-bit allows the following encoding: 

First Masklength and Prefix: 
     1 octet of length with value: 32
     4 octets of prefix with value: 192.0.2.1

First Prefix-SID:
     4 octets of Prefix-SID with value: 1001

Range Size: 
     2 octets with value: 4</artwork>
            </figure></t>

          <t>Example-2: If the following prefixes need to be mapped into the
          corresponding Prefix-SIDs: <figure suppress-title="true">
              <artwork>
10.1.1/24, Prefix-SID: 2001
10.1.2/24, Prefix-SID: 2002
10.1.3/24, Prefix-SID: 2003
10.1.4/24, Prefix-SID: 2004
10.1.5/24, Prefix-SID: 2005
10.1.6/24, Prefix-SID: 2006
10.1.7/24, Prefix-SID: 2007</artwork>
            </figure><figure suppress-title="true">
              <artwork>
The R-bit allows the following encoding: 

First Masklength and Prefix: 
     1 octet of length with value: 24
     4 octets of prefix with value: 10.1.1.0

First Prefix-SID:
     4 octets of Prefix-SID with value: 2001

Range Size: 
     2 octets with value: 7</artwork>
            </figure></t>

          <t>In case a router receives Mapping Server SubTLVs (from the same
          router or from different routers) with inconsistencies (e.g.: the
          same prefix is advertised twice with different SIDs or a range
          overlaps with another one) the router MUST use, for any given
          SID/Prefix mapping, the last received mapping.</t>

          <t>A router receiving a SRMS SubTLV MUST validate the received
          mappings against the content of its routing table. Only the mapping
          corresponding to existing RIB prefixes MUST be considered. All other
          mappings MUST NOT be used until the prefix they refer to appears in
          the RIB.</t>
        </section>
      </section>

      <section anchor="MCS"
               title="Segment Routing Mirroring Context Sub-TLV (SRMC)">
        <t>The SRMC Sub-TLV allows a node (called the mirroring node) to
        advertise its capability to mirror another node (called the mirrored
        node). The mirroring node is identified by its IPv4/IPv6 address or
        its related Prefix-SID. The mirroring node advertises in the SRMC
        Sub-TLV the context segment that needs to be used in order to invoke
        its mirroring service for the mirrored node.</t>

        <t>Examples of mirroring services use cases are defined in
        [draft-filsfils-segment-routing-use-cases] and <xref
        target="I-D.minto-rsvp-lsp-egress-fast-protection"></xref>.</t>

        <t>The SRMC Sub-TLV is optional and MAY be present in the Router
        Capability TLV (TLV-242), MAY appear more than once and has following
        format:<figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type        |     Length    |          SRMC Flags           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Mirrored Address  (variable)             |

|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Context-SID (4 octets)                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where: </artwork>
          </figure><list style="hanging">
            <t>Type: TBA.</t>

            <t>Length: variable.</t>

            <t>SRMC Flags: 2 octets field of flags. Following flags are
            defined: <figure>
                <artwork> 
        0                   1
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |I|V|R|                         | 
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       where:</artwork>
              </figure><list style="hanging">
                <t>I-flag: IPv4 flag. If set, the Mirrored Address is an IPv4
                address.</t>

                <t>V-flag: IPv6 flag. If set, the Mirrored Address is an IPv6
                address.</t>

                <t>R-flag: Segment Routing Identifier. If set, the Mirrored
                Address is a SID.</t>

                <t>Other bits: MUST be zero when originated and ignored when
                received.</t>
              </list></t>

            <t>Mirrored Address: the IPv4 or IPv6 or SID value representing
            the mirrored element.</t>

            <t>Context-SID: 32 bit value of Segment Identifier for the
            Mirroring Service.</t>
          </list></t>
      </section>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>TBD</t>
    </section>

    <section anchor="Manageability" title="Manageability Considerations">
      <t>TBD</t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>TBD</t>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>We would like to thank Les Ginsberg, Dave Ward, Dan Frost, Stewart
      Bryant, Hannes Gredler, Pierre Francois and Martin Horneffer for their
      contribution to the content of this document.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?>

      <reference anchor="ISO10589">
        <front>
          <title>Intermediate system to Intermediate system intra-domain
          routeing information exchange protocol for use in conjunction with
          the protocol for providing the connectionless-mode Network Service
          (ISO 8473)</title>

          <author>
            <organization abbrev="ISO">International Organization for
            Standardization</organization>
          </author>

          <date month="Nov" year="2002" />
        </front>

        <seriesInfo name="ISO/IEC" value="10589:2002, Second Edition" />
      </reference>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5305.xml"?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5120.xml"?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5308.xml"?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4971.xml"?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4206.xml"?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5311.xml"?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5316.xml"?>

      <?rfc ?>
    </references>

    <references title="Informative References">
      <reference anchor="draft-filsfils-rtgwg-segment-routing-00">
        <front>
          <title>Segment Routing</title>

          <author fullname="Stefano Previdi" initials="S." surname="Previdi"></author>

          <author fullname="Clarence Filsfils" initials="C."
                  surname="Filsfils"></author>

          <date day="20" month="May" year="2013" />
        </front>
      </reference>

      <reference anchor="draft-filsfils-rtgwg-segment-routing-use-cases-00">
        <front>
          <title>Segment Routing Use Cases</title>

          <author fullname="Clarence Filsfils" initials="C."
                  surname="Filsfils"></author>

          <date day="20" month="May" year="2013" />
        </front>
      </reference>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-minto-rsvp-lsp-egress-fast-protection-02.xml"?>

      <?rfc ?>
    </references>
  </back>
</rfc>
